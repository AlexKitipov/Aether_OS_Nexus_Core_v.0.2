# vnode/mail-service/vnode.yml
vnode:
  name: "mail-service"
  version: "0.1.0"
  maintainer: "aetheros-core-team@aetheros.org"
  mode: strict # A core system service for messaging

runtime:
  entrypoint: "bin/mail-service.vnode"
  required_mem_mb: 16 # For message queues, temporary storage, and IPC buffers
  max_cpu_share: 0.05 # Primarily handles messages, low CPU usage expected

capabilities:
  - CAP_IPC_ACCEPT # To accept requests from client V-Nodes (e.g., mail client app)
  - CAP_IPC_CONNECT: "svc://vfs" # To access user's mailbox files (e.g., /home/<AID>/mail)
  - CAP_IPC_CONNECT: "svc://socket-api" # For sending/receiving mail via network protocols (SMTP, POP3, IMAP)
  - CAP_IPC_CONNECT: "svc://dns-resolver" # For resolving mail server hostnames
  - CAP_LOG_WRITE # For logging mail operations and errors
  - CAP_TIME_READ # For timestamping messages or internal timing

storage:
  mounts:
    - path: "/home/<AID>/mail"
      source: "aetherfs://user/<AID>/mail"
      options: [ "rw", "recursive" ] # Read/write access to user's mail directories
    - path: "/etc/mail"
      source: "aetherfs://system-config/mail"
      options: [ "ro" ] # Read-only for system-wide mail configurations

observability:
  metrics: ["mail_sent_total", "mail_received_total", "mailboxes_listed_total", "messages_read_total", "errors_total"]
